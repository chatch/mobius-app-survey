<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>SurveyJS</title>
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" />
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.1/knockout-debug.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/survey-knockout/survey.css" />
    <link rel="stylesheet" href="./index.css" />
</head>

<body>
    <div class="sv_main sv_frame sv_default_css">
        <div class="sv_container">
            <div class="sv_header_dapp_status">
              <div class="fees-notice">
                <div><b>Rewards:</b> Fill out a survey (1 MOBI)</div>
                <div><b>Fees:</b> Create New Survey (10 MOBI)</div>
                <div><small>NOTE: ALL fees will be donated to <a href="https://stemchain.io" target="_blank">STEMchain</a> projects.</small></div>
                <button id="info-button" type="button" class="btn btn-info" 
                        data-toggle="modal" 
                        data-target="#info-modal">
                    About
                </button>
              </div>
              <div>
                <div><b>Your Balance:</b> <span id="mobi-user-balance">loading ...</span> MOBI</div>
                <div><b>DAPP Balance:</b> <span id="mobi-app-balance">loading ...</span> MOBI</div>
              </div>
            </div>
            <div class="sv_header">
                <h3>Survey Rewards</h3>
            </div>
            <div class="sv_body">
              <div id="surveys-list" class="surveys-list">
                  <section>
                    <button id="add-button" type="button" class="btn btn-primary" 
                            data-loading-text="Loading..." 
                            data-toggle="modal" 
                            data-target="#confirm-new-survey-modal">
                        Add
                    </button>
                    <!-- Modal: Confirm New Survey -->
                    <div id="confirm-new-survey-modal" class="modal fade" tabindex="-1" role="dialog">
                      <div class="modal-dialog" role="document">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h4 class="modal-title">Add New Survey</h4>
                          </div>
                          <div class="modal-body">
                            <div class="container">
                              <form class="form-horizontal">
                                <div class="form-group">
                                  <label class="col-md-2 control-label">How many survey completions?</label>
                                  <div class="col-md-2">
                                    <input id="survey-completions" type="number" value="20" class="form-control"/>
                                  </div>
                                </div>
                                <div class="form-group">
                                  <label class="col-md-2 control-label">Fee</label>
                                  <div class="col-md-2">
                                    <p class="form-control-static">10 MOBI</p>
                                  </div>
                                </div>
                                <div class="form-group">
                                  <label class="col-md-2 control-label">Total Cost</label>
                                  <div class="col-md-2">
                                    <p class="form-control-static"><span id="total-cost">10</span> MOBI</p>
                                  </div>
                                </div>
                              </form>
                            </div>
                          </div>
                          <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary" 
                              data-bind="click: function() { $('#confirm-new-survey-modal').modal('hide'); createSurvey('NewSurvey' + Date.now(), loadSurveys); }">Add</button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </section>
                  <table class="table table-striped">
                      <tbody>
                          <!-- ko foreach: availableSurveys -->
                          <tr>
                              <td data-bind="text: name"></td>
                              <td>
                                  <a class="sv_button_link" data-bind="attr: { href: 'survey.html?id=' + ko.unwrap(id) }">Run</a>
                                  <a class="sv_button_link" data-bind="attr: { href: 'editor.html?id=' + ko.unwrap(id)+'&name='+ko.unwrap(name) }">Edit</a>
                                  <a class="sv_button_link" data-bind="attr: { href: 'results.html?id=' + ko.unwrap(id) }">Results</a>
                                  <span class="sv_button_link sv_button_delete" data-bind="click: function() { $parent.deleteSurvey(ko.unwrap(id), $parent.loadSurveys); }">Delete</span>
                              </td>
                          </tr>
                          <!-- /ko -->
                      </tbody>
                  </table>
              </div>
        </div>
        <footer class="container">
          <div class="row">
            <div class="col-md-6">Powered by <a href="https://mobius.network/" target="_blank">Mobius</a>, <a href="https://stellar.org/" target="_blank">Stellar</a> and <a href="https://surveyjs.io/" target="_blank">SurveyJS</a></div>
          </div>
          <div class="row">
            <div class="col-md-6">Source code @ <a href="https://source.deco.network/hatch/entry-hacksummit-survey/" target="_blank">Deconet</a></div>
          </div>
        </footer>
      </div>
    </div>
    
    <!-- Modal: About -->
    <div id="info-modal" class="modal fade" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">About</h4>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-md-12">
                Survey Rewards enables users to create surveys and reward those 
                who complete surveys with MOBI tokens. It operates like Google 
                Opinion Rewards but for the Mobius store.
              </div>
            </div>
            <div class="row">
              <div class="col-md-12">
                A base fee of 10 MOBI is charged to create a survey. In addition 
                1 MOBI per completed survey must be provisioned to reward 
                participants. On survey create you can specify how many survey
                  completions you would like to target. So for example if you 
                  want 100 users to complete your survey then the cost of survey
                  creation will be 100 MOBI (to be payed to 100 users as reward)
                  plus 10 MOBI base fee for a total of 110 MOBI.
              </div>
            </div>
            <div class="row">
              <div class="col-md-12">
                  The 10 MOBI base fee is collected by the DApp and will be later
                  exchanged for STEM tokens and donated to <a href="https://stemchain.io" target="_blank">STEMchain</a> approved projects.
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <script src="./main.js"></script>
    <script>
      $(document).ready(function() {
        // doing this in app as the current setup (elb) doesn't support this automatically
        if (window.location.protocol === 'http:' && window.location.hostname !== 'localhost') {
          window.location.href = window.location.href.replace('http:', 'https:')
        }
        initSurveyList()
      })
    </script>

</body>

</html>
